/*[[
  Generate delta values based on gv$system_event,gv$sys_time_model. Usage: @@NAME [options] [-e|-t] {{[<inst_id>] [keyword]}|["<commands>"]} 
  -e: only show info of gv$session_event
  -t: only show info of gv$sess_time_model
  --[[
        &filter: default={a}, e={e}, t={t}
  --]]
]]*/
{
    sql=[[
        SELECT /*+no_expand*/ a.*
        FROM   (SELECT inst_id, 'Time' class#, stat_name NAME, 1 count,VALUE * 1e-3 "ms",null "ms(avg)"
                FROM   gv$sys_time_model
                WHERE  ((stat_name not like '%background%') or :V2 is not null)
                AND    :filter in('a','t')
                UNION ALL
                SELECT inst_id, 'Event['||wait_class||']', event, total_waits,TIME_WAITED_MICRO * 1e-3 t,null
                FROM   gv$system_event
                where  (wait_class!='Idle' or :V2 is not null)
                AND    :filter in('a','e')) a
        WHERE  (:V1 IS NULL AND (:snap_cmd is null or inst_id=userenv('instance')) OR :V1=INST_ID OR :V1='0') 
        and    (:V2 is null or lower(name) like '%&V3%') 
        and    count>0
    ]],
    agg_cols="ms,count",
    agg_model="ms(avg)=ms/count",
    grp_cols="inst_id,sid,class#,name",
    top_grp_cols="name"
}